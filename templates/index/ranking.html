{% extends "base.html" %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}

{% block title %}{% trans "LieroGBG" %} {% trans "ranking" %}{% endblock %}

{% block submenu %}
<ul class="nav nav-pills navbar-left">
    <li class="dropdown">
        <a class="dropdown-toggle" id="show" data-toggle="dropdown">
            Show <span class="caret"></span>
        </a>
        <ul class="dropdown-menu" role="menu">
            <li role="presentation">
                <label role="menu-item"><input type="checkbox" id="inactive-players-checkbox">
                    Inactive players
                </label>
            </li>
        </ul>
    </li>
    {% if user.is_authenticated %}
        <li id="add_game">
            <a href="{% url 'index.views.add_game' %}">{% trans "Add match" %}</a>
        </li>
        <li id="add_tournament">
            <a href="{% url 'index.views.add_tournament' %}">{% trans "Add tournament" %}</a>
        </li>
    {% endif %}
</ul>
<ul class="nav nav-pills navbar-right">
    <li id="ranking" >
        <a href="{% url 'index.views.ranking' %}">{% trans "Ranking" %}</a>
    </li>
    <li id="games" >
        <a href="{% url 'index.views.games' %}">{% trans "Matches" %}</a>
    </li>
    <li id="tournaments" >
        <a href="{% url 'index.views.tournaments' %}">{% trans "Tournaments" %}</a>
    </li>
</ul>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-xs-12">
        {% include 'index/includes/list_players.html' with players=players %}
    </div>
    <div class="col-xs-12">
        {% trans 'The last match was played ' %}<time class="timeago" datetime="{{ last_game_time }}"></time>
    </div>
</div>
{% endblock %}

{% block custom_scripts %}
<script src="{{ STATIC_URL }}/js/jquery.timeago.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}/js/jquery.timeago.{{ LANGUAGE_CODE }}.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {
    'use strict';
    $(".timeago").timeago();
    $('#inactive-players-checkbox').click(function () {
        update_games_played();
    });

    function update_games_played() {
        if ($('#inactive-players-checkbox').prop('checked') === true) {
            var url = "{% url 'index.views.get_players_list' False %}";
        } else {
            var url = "{% url 'index.views.get_players_list' True %}";
        }
        $.ajax({
            type: "GET",
            url: url,
            traditional: true,
            success: function(data) {
                $("#id_ranking_table").replaceWith(data);
                update_images();
            },
            error: function(xhr, textStatus, errorThrown) {
                alert("Please report this error: " + errorThrown + xhr.status +
                      xhr.responseText);
            }
        });
    }
});
</script>
{% endblock %}

